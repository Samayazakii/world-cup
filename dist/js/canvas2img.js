"use strict";var Canvas2Image=function(){var t,e,o=(t=document.createElement("canvas"),{canvas:!!(e=t.getContext("2d")),imageData:!!e.getImageData,dataURL:!!t.toDataURL,btoa:!!window.btoa}),i="image/octet-stream";function u(t,e,n){var r=t.width,a=t.height;null==e&&(e=r),null==n&&(n=a);var o=document.createElement("canvas"),i=o.getContext("2d");return o.width=e,o.height=n,i.drawImage(t,0,0,r,a,0,0,e,n),o}function c(t,e,n,r){return(t=u(t,n,r)).toDataURL(e)}function g(t){document.location.href=t}function f(t){var e=document.createElement("img");return e.src=t,e}function m(t){return"image/"+(t=t.toLowerCase().replace(/jpg/i,"jpeg")).match(/png|jpeg|bmp|gif/)[0]}function b(t){if(!window.btoa)throw"btoa undefined";var e="";if("string"==typeof t)e=t;else for(var n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return btoa(e)}function v(t){var e=t.width,n=t.height;return t.getContext("2d").getImageData(0,0,e,n)}function d(t,e){return"data:"+e+";base64,"+t}var s=function(t){var e=t.width,n=t.height,r=e*n*3,a=r+54,o=[66,77,255&a,a>>8&255,a>>16&255,a>>24&255,0,0,0,0,54,0,0,0],i=[40,0,0,0,255&e,e>>8&255,e>>16&255,e>>24&255,255&n,n>>8&255,n>>16&255,n>>24&255,1,0,24,0,0,0,0,0,255&r,r>>8&255,r>>16&255,r>>24&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],u=(4-3*e%4)%4,c=t.data,g="",f=e<<2,m=n,v=String.fromCharCode;do{for(var d=f*(m-1),s="",p=0;p<e;p++){var h=p<<2;s+=v(c[d+h+2])+v(c[d+h+1])+v(c[d+h])}for(var l=0;l<u;l++)s+=String.fromCharCode(0);g+=s}while(--m);return b(o.concat(i))+b(g)},r=function(t,e,n,r){if(o.canvas&&o.dataURL)if("string"==typeof t&&(t=document.getElementById(t)),null==r&&(r="png"),r=m(r),/bmp/.test(r)){var a=v(u(t,e,n));g(d(s(a),i))}else{g(c(t,r,e,n).replace(r,i))}},a=function(t,e,n,r){if(o.canvas&&o.dataURL){if("string"==typeof t&&(t=document.getElementById(t)),null==r&&(r="png"),r=m(r),/bmp/.test(r)){var a=v(u(t,e,n));return f(d(s(a),"image/bmp"))}return f(c(t,r,e,n))}};return{saveAsImage:r,saveAsPNG:function(t,e,n){return r(t,e,n,"png")},saveAsJPEG:function(t,e,n){return r(t,e,n,"jpeg")},saveAsGIF:function(t,e,n){return r(t,e,n,"gif")},saveAsBMP:function(t,e,n){return r(t,e,n,"bmp")},convertToImage:a,convertToPNG:function(t,e,n){return a(t,e,n,"png")},convertToJPEG:function(t,e,n){return a(t,e,n,"jpeg")},convertToGIF:function(t,e,n){return a(t,e,n,"gif")},convertToBMP:function(t,e,n){return a(t,e,n,"bmp")}}}();